@model SUP_MVC.Models.Search.SearchViewModel

@{
	ViewData["Title"] = "Search";
}
<html>
<head>
    <meta charset="utf-8">
    <title>Search</title>
    <style>
        .organize {
            width: 100%;
            height: 100%;
        }

        .logo {
            height: 95%;
            float: right;
            top: 1px;
            margin-top: 2px;
            margin-right: 2px;
        }

        .universitylogo {
            height: 95%;
            float: right;
            top: 1px;
            margin-top: 2px;
            margin-right: 2px;
        }

        #button {
            text-align: inherit;
        }

        .popupForm {
            display: none;
            background-color: #E0E0E0;
            border: 1px solid black;
            position: fixed;
            bottom: 10%;
            top: 10%;
            left: 10%;
            right: 10%;
        }
    </style>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            Search();
            $('.searchOrganization').change(function () {
                Search();
            });
            $('.checkAll').click(function () {
                var checkedAll = false;
                checkedAll = $('.checkAll').prop('checked');
                $('.rowSelected').each(function () {
                    if (checkedAll != $(this).prop('checked')) {
                        $(this).click();
                    }
                });
            })
        })
        function Search() {
            var firstName = $('.searchFirstName').val();
            var lastName = $('.searchLastName').val();
            var organization = $(".searchOrganization option:selected").text(); //$('.searchOrganization').val();

            var dataPost = firstName + ',' + lastName + ',' + organization;
            $.ajax({
                url: '/Search/SearchClients',
                type: 'POST',
                data: JSON.stringify(dataPost),
                contentType: 'application/json; charset=utf-8',
                error: function (xhr) {
                    alert('Error: ' + xhr.statusText);
                },
                success: function (result) {
                    var returnedData = JSON.parse(result);
                    $('.removableRow').remove();
                    $('.templateRow').hide();
                    if (returnedData.length == 0) {
                        $('.templateRow').show();
                    }
                    for (var i = 0; i < returnedData.length; i++) {
                        var currentRow = returnedData[i];
                        var Row = $('.templateRow').clone();
                        Row.removeClass('templateRow').addClass('removableRow').show();
                        Row.find('.rowFirstName').val(currentRow['First_Name']);
						Row.find('.rowLastName').val(currentRow['Last_Name']);
						Row.find('.rowEmailAddress').val(currentRow['EmailAddress']);
                        Row.find('.rowPhoneNumber').val(currentRow['PhoneNumber']);
                        if (currentRow['Org'] != null) {
                            Row.find('.rowOrganization').val(currentRow['Org']['Org_Name']);
                        }
                        var clientId = currentRow['ID']
                        Row.find('.rowViewButton').val(clientId);
                        $('.checkedId').each(function (index) {
                            if ($(this).text() == clientId) {
                                Row.find('.rowSelected').prop('checked', true);
                            }
                        });
                        $('.templateRow').parent().append(Row);
                    }
                    $('.rowViewButton').unbind('click').click(function () {
                        editClient($(this).val());
                    });
                    $('.rowSelected').unbind('click');
                    $('.rowSelected').click(function () {
                        var clientId = $(this).parent().parent().find('.rowViewButton').val();
                        if ($(this).prop('checked') == true) {
                            var Row = $('.checkedIdTemplate').clone();
                            Row.removeClass('checkedIdTemplate').addClass('checkedId');
                            Row.text(clientId);
                            $('.checkedIdsDiv').append(Row);
                        } else {
                            $('.checkedId').each(function (index) {
                                if ($(this).text() == clientId) {
                                    $(this).remove();
                                }
                            });
                        }
                    });
                },
                async: true,
                processData: false
            });
        }

        function editClient(clientId) {
            location.href = '/AddClient/AddClient?clientId=' + clientId;
        }

        function popForm() {
            document.getElementById("form").style.display = "block";
        }

        function closeForm() {
            document.getElementById("form").style.display = "none";
        }
        function toggle(source) {
            var checkboxes = document.getElementsByName('selectAll');
            for (var checkbox in checkboxes)
                checkbox.checked = source.checked;
        }

        function allCheck(name, boolValue) {
            var allvalue = document.getElementsByName(name);
            for (var i = 0; i < allvalue.length; i++) {
                if (allvalue[i].type == "checkbox")
                    allvalue[i].checked = boolValue;
            }
        }

        function reserveCheck(name) {
            var revalue = document.getElementsByName(name);
            for (i = 0; i < revalue.length; i++) {
                if (revalue[i].checked == true)
                    revalue[i].checked = false;
                else
                    revalue[i].checked = true;
            }
        }

    </script>
</head>


	<body class="organize">
        <div class="checkedIdsDiv" style="display:none;">
            <p class="checkedIdTemplate"></p>
        </div>
		<div style="position: absolute; left: 15%; top: 10%; width: 85%;">
			<div style="position:relative; margin-left: 25%; width: 650px;" align="right">
				<table style="position:relative; left: -90px">
					<tr>
						<td>
							<p align="center">First Name</p>
						</td>
						<td>
							<p align="center">Last Name</p>
						</td>
						<td>
							<p align="center">Category</p>
						</td>
					</tr>
					<tr>
						<td>
							<input class="searchFirstName" type="text" onKeyUp="Search()" placeholder="First Name">
						</td>
						<td>
							<input class="searchLastName" type="text" onKeyUp="Search()" placeholder="Last Name">
						</td>
						<td>
							<select class="searchOrganization" onKeyUp="Search()" name="category">
								<!--We need to keep an empty option to allow searches that do not include organization-->
								<option value=""></option>
								<option value="business">Business</option>
								<option value="electedOfficial">Elected Official</option>
								<option value="school">School</option>
								<option value="elementary">Elementary</option>
								<option value="middle">Middle</option>
								<option value="highSchool">High School</option>
								<option value="higherEd">Higher Ed.</option>
								<option value="nonProfit">Non-profit</option>
								<option value="UWSystem">UW-System</option>
								<option value="boardOfRegent">Board of Regent</option>
								<option value="foundation">Foundation</option>
								<option value="other">Other</option>
							</select>
						</td>
					</tr>
					<tr><td height="10px"></td></tr>
				</table>
			</div>
			<table style="position:relative; margin-left: calc(10% + 120px); left: -15px">
				<tbody>
					<tr>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
						<td>
							<a href="javascript:allCheck('choice',true)">Select</a>
							<a href="javascript:allCheck('choice',false)">No select</a>
							<a href="javascript:reserveCheck('choice')"> Inverse</a>
						</td>
					</tr>
					<tr>
						<td></td>
						<td style="width: 183px">
							<p><b>First Name</b></p>
						</td>
						<td style="width: 188px">
							<p><b>Last Name</b></p>
						</td>
						<td style="width: 199px">
							<p><b>Category</b></p>
						</td>
						<td style="width: 175px">
							<p><b>Email</b></p>
						</td>
						<td style="width: 128px">
							<p><b>Phone #</b></p>
						</td>
						<td>
							<input class="checkAll" type="checkbox" name="choice" id="choice">
						</td>
					</tr>
				</tbody>
			</table>
			<div style="height: 420px; overflow-y:scroll; overflow-x: hidden; width: 1050px; margin-left: calc(10% - 20px);" align="right">
				<table style="position:relative; left: -20px">
					<tbody>
						<tr class="templateRow" style="">
							<td>
								<button class="rowViewButton" value="0">View</button>
							</td>
							<td>
								<input class="rowFirstName" type="text" value="" disabled="true">
							</td>
							<td>
								<input class="rowLastName" type="text" value="" disabled="true">
							</td>
							<td>
								<input class="rowOrganization" type="text" value="" disabled="true">
							</td>
							<td>
								<input class="rowEmailAddress" type="text" value="" disabled="true">
							</td>
							<td>
								<input class="rowPhoneNumber" type="text" value="" disabled="true">
							</td>
							<td>
								<input class="rowSelected" type="checkbox" name="choice" id="choice" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
			<button class="template" onclick="popForm()" >Select Template</button>
			<div class="popupForm" id="form">
				<form action="middlewareHere" class="form-container">
					<h1>Login</h1>

					<label for="email"><b>Email</b></label>
					<input type="text" placeholder="Enter Email" name="email" required>

					<label for="psw"><b>Password</b></label>
					<input type="password" placeholder="Enter Password" name="psw" required>

					<button type="submit" class="btn">Login</button>
					<button type="button" class="btn cancel" onclick="closeForm()">Close</button>
				</form>

			</div>
		</div>
	</body>
</html>